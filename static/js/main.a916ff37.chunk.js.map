{"version":3,"sources":["iframe/WhisperIframe.js","fit_to_screen.js","App.js","index.js"],"names":["WhisperIframe","props","bridge","watchdogTimeout","state","key","Date","getTime","method","this","Promise","reject","args","invoke","IframeBridge","iframe","contentWindow","exposeFunction","response","console","log","error","setState","watchdog","_watchdog","close","clearTimeout","setTimeout","timeoutPromise","resolve","race","then","catch","ref","src","title","React","Component","ScreenService","screenWidth","screenHeight","_screenWidth","_screenHeight","isVertical","uiWidth","uiHeight","fittoscreen","window","width","innerWidth","height","innerHeight","screenService","scale","document","body","classList","add","remove","screenRatio","uiRatio","scaleX","scaleY","el","style","offsetX","Math","floor","offsetY","scaleStr","App","url","useEffect","fit_ui_container","onresize","qs","parse","location","search","slice","pathname","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.a916ff37.chunk.js","sourcesContent":["import React from 'react';\nimport { IframeBridge } from 'wisper-rpc';\nimport './Iframe.css';\n\nexport default class WhisperIframe extends React.Component {\n        bridge = null;\n        watchdogTimeout = null;\n\n        constructor(props){\n            super(props);\n            this.state = {\n                key: (new Date()).getTime()\n            }\n        }\n\n        invoke(method, ...args) {\n            if (this.bridge === null) {\n                return Promise.reject(\"Iframe not ready\");\n            }\n\n            return this.bridge.invoke(method, [...args]);\n        }\n\n        componentDidMount() {\n            this.bridge = new IframeBridge(this.iframe.contentWindow);\n\n\n            this.bridge.exposeFunction('onReady', (response) => {\n                console.log('onReady', {response});\n                this.invoke(\"play\");\n                return true;\n            });\n\n            this.bridge.exposeFunction('onPlay', (response) => {\n                console.log('onPlay', {response});\n                \n                return true;\n            });\n\n            this.bridge.exposeFunction('onError', (error) => {\n                console.log('onError', {error});\n\n                return true;\n            });\n\n            this.bridge.exposeFunction('onDone', (response) => {\n                console.log('onDone', {response});\n                this.setState({\n                    key: (new Date()).getTime()\n                })\n                \n                return true;\n            });\n\n\n            if (this.props.watchdog) {\n                this._watchdog();\n            }\n\n        }\n\n        componentWillUnmount() {\n            this.bridge.close();\n            this.iframe = null;\n            this.bridge = null;\n            clearTimeout(this.watchdogTimeout);\n        }\n\n        _watchdog() {\n            this.watchdogTimeout = setTimeout(()=>{\n                let timeoutPromise = new Promise((resolve, reject)=>setTimeout(reject, 1000));\n                Promise\n                    .race([this.invoke(\"ping\"), timeoutPromise])\n                    .then(()=>this._watchdog())\n                    .catch((error)=> console.log('onError', {error}));\n            }, 30000);\n        }\n\n        render() {\n            const {key} = this.state;\n            \n            return <iframe ref={(iframe)=>{this.iframe = iframe}} src={this.props.src} title={this.props.src} key={key} />\n        }\n}","class ScreenService {\n\n    constructor(screenWidth, screenHeight) {\n        this._screenWidth = screenWidth;\n        this._screenHeight = screenHeight;\n    }\n\n    get screenWidth() {\n        return this._screenWidth;\n    }\n\n    get screenHeight() {\n        return this._screenHeight;\n    }\n\n    get isVertical() {\n        return this.screenWidth < this.screenHeight;\n    }\n\n    get screenRatio() {\n        return this.screenWidth / this.screenHeight\n    }\n\n    get uiWidth() {\n        return this.isVertical ? 1080 : 1920;\n    }\n\n    get uiHeight() {\n        return this.isVertical ? 1920 : 1080;\n    }\n\n    get uiRatio() {\n        return this.uiWidth / this.uiHeight;\n    }\n\n}\n\nexport default () => {\n    const fittoscreen = window.fittoscreen || false;\n\n    const width = window.innerWidth\n    const height = window.innerHeight\n\n    const screenService = new ScreenService(width, height);\n\n    let scale = 1;\n\n    if (screenService.isVertical) {\n        document.body.classList.add('vertical');\n    } else {\n        document.body.classList.remove('vertical');\n    }\n\n\n    if (screenService.screenRatio >= screenService.uiRatio) { // Wider or equal\n        scale = screenService.screenHeight/ screenService.uiHeight;\n    } else { // Narrower\n        scale = screenService.screenWidth/ screenService.uiWidth;\n    }\n\n\n    let scaleX = fittoscreen ? screenService.screenWidth / screenService.uiWidth : scale;\n    let scaleY = fittoscreen ?  screenService.screenHeight / screenService.uiHeight : scale;\n\n    const el = document.body;\n    el.style['-ms-zoom'] = scaleX < scaleY ? scaleX : scaleY;\n\n    let offsetX = Math.floor((screenService.screenWidth - (scaleX * screenService.uiWidth)) / 2);\n    let offsetY = Math.floor((screenService.screenHeight - (scaleY * screenService.uiHeight)) / 2);\n\n    let scaleStr = \"scale(\" + scaleX + \",\" + scaleY + \")\";\n    if (offsetX > 0 || offsetY > 0) {\n        scaleStr = \"translateX(\" + offsetX + \"px) translateY(\" + offsetY + \"px) \" + scaleStr;\n    }\n    el.style['-moz-transform'] = scaleStr;\n    el.style['-o-transform'] = scaleStr;\n    el.style['-webkit-transform'] = scaleStr;\n    el.style['transform'] = scaleStr;\n    el.style['transform-origin'] = \"left top\";\n}\n","import React, {useEffect} from 'react';\n\nimport WisperIframe from './iframe/WhisperIframe';\nimport fit_ui_container from './fit_to_screen';\n\n\nconst App = ({url}) => {\n\n  useEffect(() => {\n    fit_ui_container();\n\n    window.onresize = fit_ui_container;\n  })\n\n  return <WisperIframe src={url} />;\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport qs from \"qs\";\n\nimport App from './App';\n\nconst DEFAULT_URL = \"http://localhost:3000\";\n\nconst url = qs.parse(window?.location?.search?.slice(1))?.url;\nconst pathname = !!window?.location?.pathname?.slice(1) ? window.location.pathname.slice(1) : null;\n\nReactDOM.render(<App url={ url ?? pathname ?? DEFAULT_URL} />, document.getElementById('root'));"],"sourceRoot":""}